<!doctype html>
          <p class="text-gray-500">Stock: ${p.stock}</p>
        </div>
        <div class="mt-3">
          <input type="number" id="qty_${p.id}" min="0" value="0" class="border p-1 w-16 rounded text-center" />
          <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 mt-2 w-full" onclick="addToCart('${p.id}')">Add to Cart</button>
        </div>`;
      container.appendChild(card);
    });
  }

  function addToCart(id){
    const qty = parseInt(document.getElementById(`qty_${id}`).value) || 0;
    if(qty <= 0) return alert('Please enter a valid quantity.');
    cart[id] = (cart[id] || 0) + qty;
    updateCart();
  }

  function updateCart(){
    const preview = document.getElementById('cartPreview');
    const lines = Object.keys(cart).map(id => {
      const p = products.find(x => x.id === id);
      return `${p.name} × ${cart[id]} = ₹${p.price * cart[id]}`;
    });
    preview.textContent = lines.join('\n') || 'Cart is empty';
  }

  document.getElementById('orderForm').addEventListener('submit', async e => {
    e.preventDefault();
    if(Object.keys(cart).length === 0) return alert('Cart is empty!');
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const items = Object.keys(cart).map(id => ({ productId: id, qty: cart[id] }));
    const res = await fetch(`${API}/orders`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ items, customer: { name, email }, paymentMethod: 'mock' })
    });
    if(!res.ok) return alert('Order failed: ' + (await res.json()).error);
    const j = await res.json();
    alert(`✅ Order placed!\nOrder ID: ${j.orderId}\nShipment ID: ${j.shipmentId}`);
    Object.keys(cart).forEach(k => delete cart[k]);
    updateCart();
    loadProducts();
  });

  document.getElementById('trackBtn').addEventListener('click', async ()=>{
    const id = document.getElementById('trackId').value.trim();
    if(!id) return alert('Enter a shipment ID');
    const res = await fetch(`${API}/shipments/${id}`);
    const result = document.getElementById('trackResult');
    if(!res.ok) return result.textContent = '❌ Shipment not found.';
    const data = await res.json();
    result.textContent = JSON.stringify(data, null, 2);
  });

  loadProducts();
  </script>
</body>
</html>
